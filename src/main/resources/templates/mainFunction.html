<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title th:text="${title}">Bubble Sort Visualization</title>
    <link rel="stylesheet" th:href="@{/css/headerFooter.css}">
    <link rel="stylesheet" th:href="@{/css/algoVis.css}">

    <style>
        /* =========================
           VISUALIZATION PAGE SCOPE
           ========================= */
        .viz-page {
            margin-top: var(--header-height); /* respect fixed header */
            padding: 2rem;
            flex: 1; /* allows footer to stay at bottom */
        }

        .viz-controls {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        .viz-page #array-container {
            position: relative;
            height: 320px;
            max-width: 1200px;
            margin: 2rem auto;
            border-bottom: 3px solid #333;
            background: #f9fafb;
            overflow: hidden;
        }

        .viz-page .array-element {
            position: absolute;
            bottom: 0;
            width: var(--barW);
            background-color: steelblue;
            color: white;

            display: flex;
            align-items: flex-end;
            justify-content: center;

            font-size: 14px;
            font-weight: bold;

            border-radius: 6px 6px 0 0;

            transition:
                    height 0.4s ease,
                    transform 0.4s ease,
                    background-color 0.3s ease,
                    box-shadow 0.3s ease;
        }

        /* =========================
         ARRAY CONTAINER
         ========================= */
        #array-container {
            position: relative;
            height: 300px;                 /* chart height */
            margin: 40px auto;
            border-bottom: 3px solid #333;
            background: #f9fafb;
            overflow: hidden;
        }

        /* =========================
           BAR ELEMENTS
           ========================= */
        .array-element {
            position: absolute;
            bottom: 0;                     /* THIS makes bars vertical */
            width: var(--barW);            /* controlled by JS */
            background-color: steelblue;
            color: white;

            display: flex;
            align-items: flex-end;
            justify-content: center;

            font-size: 14px;
            font-weight: bold;

            border-radius: 6px 6px 0 0;

            transition:
                    height 0.4s ease,
                    transform 0.4s ease,
                    background-color 0.3s ease,
                    box-shadow 0.3s ease;
        }

        /* =========================
           STATES
           ========================= */
        .array-element.current {
            background-color: #facc15; /* yellow */
            box-shadow: 0 0 12px rgba(250, 204, 21, 0.8);
        }

        .array-element.sorted {
            background-color: #22c55e; /* green */
        }

        .array-element.current.sorted {
            background-color: #16a34a;
        }

        /* =========================
           BINARY SEARCH RANGE
           ========================= */
        .array-element.out-of-range {
            background-color: #d1d5db;
        }

        /* =========================
           TARGET MARKER
           ========================= */
        .target-marker {
            position: absolute;
            top: -28px;
            left: 50%;
            transform: translateX(-50%);
            font-size: 13px;
            font-weight: bold;
            color: #111827;
            background: white;
            padding: 2px 6px;
            border-radius: 4px;
            border: 1px solid #9ca3af;
            pointer-events: none;
            white-space: nowrap;
        }


        /* =========================
           GENERIC STATES (EXISTING)
           ========================= */
        .current {
            background-color: yellow;      /* currently comparing */
        }

        .sorted {
            background-color: green;       /* fixed */
            color: white;
        }

        .current-min {
            background-color: orange;      /* selection sort min */
        }

        /* =========================
           MERGE SORT (EXISTING)
           ========================= */
        .left-subarray {
            background-color: #add8e6;     /* light blue */
        }

        .right-subarray {
            background-color: #f4a460;     /* sandy brown */
        }

        .current-left {
            background-color: #00ff00;     /* green */
            border: 2px solid #008000;
        }

        .current-right {
            background-color: #ff0000;     /* red */
            border: 2px solid #800000;
        }

        /* =========================
           QUICK SORT (NEW)
           ========================= */

        /* Active partition range */
        .active-range {
            border: 2px dashed #999;
        }

        /* Pivot element */
        .pivot {
            background-color: #800080;     /* purple */
            color: white;
        }

        /* Compared / swapped indices */
        .current-a {
            background-color: #ffd700;     /* gold */
        }

        .current-b {
            background-color: #ff8c00;     /* dark orange */
        }

        /* =========================
           OPTIONAL VISUAL POLISH
           ========================= */
        .active-range:not(.pivot):not(.sorted) {
            background-color: #f0f0f0;
        }

        .sorted.pivot {
            background-color: #006400;     /* dark green */
        }
    </style>
</head>
<body>
    <div th:replace="~{fragments :: header}"></div>

    <div class="viz-page">
        <!-- <h1 th:text="${title}"></h1> -->
        <div th:insert="~{fragments:: visInfo}"></div>
        <div id="array-container"></div>

        <div class="viz-controls">
            <button id="prevBtn">Previous</button>
            <button id="nextBtn">Next</button>
            <button id="autoBtn">Auto</button>
        </div>
        
        <!-- Color Legend -->
        <div th:replace="~{fragments :: colorLegend}"></div>
    </div>
    <div th:replace="~{fragments :: footer}"></div>

    <script src="/js/core/barAnimator.js"></script>

<script th:inline="javascript">
    document.addEventListener('DOMContentLoaded', () => {
        // Use title to fetch algorithm details
        fetch("/algo/" + title, { headers: { "Accept": "application/json" } })
            .then(response => response.json())
            .then(data => {
                const description = document.querySelector(".algorithm-description");
                const timeComplexity = document.querySelector(".timeComplexity");
                const spaceComplexity = document.querySelector(".spaceComplexity");
                const category = document.querySelector(".category");
                const difficulty = document.querySelector(".difficulty");

                description.innerText = data.description || "No description available";
                timeComplexity.innerText =  data.timeComplexity || "No Time Complexity";
                spaceComplexity.innerText = data.sapceComplexity || "No Space Complexity";
                category.innerText = data.category || "No Category mentioned";
                difficulty.innerText = data.difficulty || "No difficulty set";
                document.querySelector(".difficulty").closest(".metric-badge").classList.add("difficulty-"+data.difficulty);
            });
    });

    const title = [[${title}]]; // Thymeleaf injects the page title
    let steps = [[${steps}]]; // Thymeleaf injects backend precomputed steps
    let scriptFile = '';

    if (title === 'SelectionSort') {
        scriptFile = '/js/selectionSort.js';
    } else if (title === 'BubbleSort' || title === 'InsertionSort') {
        scriptFile = '/js/bubbleAndInsertion.js';
    } else if (title === 'MergeSort') {
        scriptFile = '/js/mergeSort.js';
    } else if (title === 'QuickSort') {
        scriptFile = '/js/quickSort.js';
    } else if (title === 'LinearSearch') {
        scriptFile = '/js/linearSearch.js';
    } else if (title === 'BinarySearch') {
        scriptFile = '/js/binarySearch.js';
    }

    function loadScript(src, cb) {
    const s = document.createElement('script');
    s.src = src;
    s.onload = () => cb && cb();
    s.onerror = () => console.error("Failed to load:", src);
    document.body.appendChild(s);
}

if (scriptFile) {
    // Ensure BarAnimator exists before loading algorithm script
    if (typeof window.BarAnimator === "undefined") {
        loadScript("/js/core/barAnimator.js", () => {
            loadScript(scriptFile);
        });
    } else {
        loadScript(scriptFile);
    }
}

</script>
</body>
</html>
